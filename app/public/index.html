<!DOCTYPE html>
<html>
  <head>
    <title>Dietzel 6th Congressional Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
      html, body, #map-canvas {
        margin: 0;
        padding: 0;
        height: 100%;
        font-size: 1.0em;
        background: #f0f0f0;
      }

      @import url(http://fonts.googleapis.com/css?family=Lato:400,700italic);
      * { padding: 0; margin: 0; }
      body { background: #1abc9c; font-family: 'Lato', sans-serif; text-transform: uppercase; letter-spacing: 1px;}

      header {
          text-align: justify;
          height: 5em;
          padding: 1em 5%;
          background: #34495E;
          color: #fff;
      }

      header::after {
          content: '';
          display: inline-block;
          width: 100%;
      }

      header > div,
      header > div::before,
      header nav,
      header > div h1 {
          display: inline-block;
          vertical-align: middle;
          text-align: left;
      }

      header > div {
          height: 100%;
      }

      header > div::before {
          content: '';
          height: 100%;
      }

      header > div h1 {
          font-size: 2em;
          color: #BDC3C7;
      }

      header nav a {
          padding: 0 0.6em;
          white-space: nowrap;
      }

      header nav a:last-child {
          padding-right: 0;
      }

      .form-field {
        display: inline-block;
        margin: 0 1em 0 0;
        font-size: 0.8em;
      }

      .form-field input[type=text] {
        width: 12em;
        height: 1.5em;
      }

      button {
        border-radius: 5px;
        background: #BDC3C7;
        border: 1px solid #ECF0F1;
        padding: 0.5em 1em;
        text-transform: uppercase;
        margin: 0.5em 0 0 0;
        float: right;
      }

      button:hover {
        background: #ECF0F1;
      }

      #addressLabel {
        width: 5.5em;
      }

      .form-field label {
        width: 4em;
        display: inline-block;
      }

      .form-field div {
        margin: 0.2em 0 0 0;
      }

      h1, h3 {
        color: #F1C40F;
      }

      @media screen and (max-width: 720px){

          header {
              height: auto;
          }

          header > div,
          header > div h1,
          header nav {
              height: auto;
              width: auto;
              display: block;
              text-align: center;
          }

      }
    </style>
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&key=AIzaSyBkQCRvP_sJ7-buRrAj6G1yS3ikZ4kTsZk"></script>
  </head>
  <body>
    <header>
    <div><h1>Dietzel</h1></div>
    <nav>
        <div class="form-field">
          <form action="" method="POST" id="signup">
            <div>
              <label for="name">Name</label>
              <input type="text" id="name">
            </div>
            <div>
              <label for="email">Email</label>
              <input type="text" id="email">
            </div>
            <button type="submit">Signup</button>
          </form>
        </div>
        <div class="form-field">
          <form action="" method="POST" id="checkAddress">
            <h3>Find Voting Status</h3>
            <div>
              <label id="addressLabel" for="address">Address</label>
              <input type="text" id="address">
            </div>
            <button type="submit">Check</button>
          </form>
        </div>
    </nav>
  </header>
    <div id="map-canvas"></div>
    <script>

      var   address
          , geoLocation
          , map
          , name
          , email
          , userLocation;

      google.maps.visualRefresh = false;

      function initialize() {
        var mapOptions = {
        center: new google.maps.LatLng(91.998,31.093),
        mapTypeId: google.maps.MapTypeId.ROADMAP

        };
        map = new google.maps.Map(document.getElementById('map-canvas'),
            mapOptions);

        var district6Layer = new google.maps.KmlLayer('http://dietzel.co/x14r/la06.kml');
        district6Layer.setMap(map);

        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(onLoadGeoLocation);
        }
      }

      function onLoadGeoLocation (location) {
        geoLocation = new google.maps.LatLng(location.coords.latitude,
                                            location.coords.longitude);
        var geoMarker = new google.maps.Marker({
          map: map,
          draggable: false,
          animation: google.maps.Animation.DROP,
          position: geoLocation
        });

      }

      function saveUserData () {
        var body = {};
        name = $('#name').val();
        email = $('#email').val();
        address = $('#address').val();
        if(name.length && email.length) {
          if(geoLocation) {
            //body.geoLocation = geoLocation;
            body.geoLocation = { lat: geoLocation.lat(), 'long': geoLocation.lng() };
          }

          if(userLocation) {
            body.userLocation = user

          }
          body.name = name;
          body.email = email;
          body.address = address;

          $.ajax({
            type: 'POST',
            url: '/api/map/save',
            data: body,
            success: function (data) {
              alert('You have successfully signed up!');
            }
          });
        } else {
          return;
        }


      }

      google.maps.event.addDomListener(window, 'load', initialize);

      $('#signup').submit(function onSignup (evt) {
        evt.preventDefault();
        saveUserData();
        return false;
      });

      $('#checkAddress').submit(function onSubmit(evt) {
        evt.preventDefault();

        var geocoder = new google.maps.Geocoder();
        geocoder.geocode(
              {'address': '' + $('#address').val() + ',Baton Rouge, LA'}
            , function onGoogleResult (results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                    userLocation = new google.maps.LatLng(results[0].geometry.location.jb,
                                                          results[0].geometry.location.kb);
                    var userMarker = new google.maps.Marker({
                      map: map,
                      draggable: false,
                      animation: google.maps.Animation.DROP,
                      position: userLocation
                    });

                    address = results[0].formatted_address;
                } else {
                    console.log('Error:' + status);
                }
            }
        );

        return false;
      });



    </script>
  </body>
</html>